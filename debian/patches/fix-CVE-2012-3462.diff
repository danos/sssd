commit ffcf27b0b773b580289d596f796aaf86c45ba920
Author: Jakub Hrozek <jhrozek@redhat.com>
Date:   Wed Aug 8 19:26:35 2012 +0200

    Abort PAM access phase if HBAC does not return PAM_SUCCESS

--- a/src/providers/data_provider_be.c
+++ b/src/providers/data_provider_be.c
@@ -766,6 +766,7 @@
     pd = talloc_get_type(req->req_data, struct pam_data);
 
     if (pd->cmd == SSS_PAM_ACCT_MGMT &&
+        pd->pam_status == PAM_SUCCESS &&
         req->phase == REQ_PHASE_ACCESS &&
         dp_err_type == DP_ERR_OK) {
         if (!becli->bectx->bet_info[BET_SELINUX].bet_ops) {
